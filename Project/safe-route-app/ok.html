<!DOCTYPE html>
<html lang="en" class="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Safety – Crime & Safety Dashboards</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    .card-hover{transition:transform .2s ease, box-shadow .2s ease}
    .card-hover:hover{transform:translateY(-2px);box-shadow:0 10px 25px rgba(0,0,0,.08)}
    .backdrop{backdrop-filter: blur(6px)}
    .flip{perspective:1000px}
    .flip-inner{transition: transform .6s; transform-style:preserve-3d}
    .flip.flipped .flip-inner{transform: rotateY(180deg)}
    .flip-face{backface-visibility:hidden}
    .flip-back{transform: rotateY(180deg)}
    input[type="checkbox"]{accent-color:#16a34a}
  </style>
</head>
<body class="min-h-screen bg-slate-50 text-slate-900">
  <!-- Header -->
  <header class="sticky top-0 z-30 bg-white/80 backdrop shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-xl bg-emerald-500 grid place-items-center text-white font-bold">MS</div>
        <h1 class="text-xl font-semibold">My Safety · Crime & Safety Suite</h1>
      </div>
      <nav class="hidden sm:flex gap-1">
        <button data-tab="wanted" class="tab-btn px-3 py-2 rounded-lg text-sm font-medium hover:bg-slate-100">Wanted</button>
        <button data-tab="missing" class="tab-btn px-3 py-2 rounded-lg text-sm font-medium hover:bg-slate-100">Missing Persons</button>
        <button data-tab="report" class="tab-btn px-3 py-2 rounded-lg text-sm font-medium hover:bg-slate-100">Report to Police</button>
      </nav>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 py-8">
    <!-- Tabs for mobile -->
    <div class="sm:hidden mb-6">
      <select id="tabSelect" class="w-full border rounded-lg px-3 py-2">
        <option value="wanted">Wanted Criminals</option>
        <option value="missing">Missing Persons</option>
        <option value="report">Report Missing to Police</option>
      </select>
    </div>

    <!-- WANTED DASHBOARD -->
    <section id="tab-wanted" class="tab">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-2xl font-semibold">Wanted Criminals</h2>
        <div class="flex gap-2">
          <input id="searchWanted" placeholder="Search name, crime, area…" class="w-64 max-w-[60vw] border rounded-lg px-3 py-2 text-sm"/>
          <button id="refreshWanted" class="px-3 py-2 text-sm rounded-lg bg-slate-900 text-white hover:bg-slate-800">Refresh</button>
        </div>
      </div>

      <div id="wantedGrid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-5"></div>
    </section>

    <!-- MISSING PERSONS DASHBOARD -->
    <section id="tab-missing" class="tab hidden">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-2xl font-semibold">Missing Persons</h2>
        <div class="flex gap-2">
          <input id="searchMissing" placeholder="Search name, hometown…" class="w-64 max-w-[60vw] border rounded-lg px-3 py-2 text-sm"/>
          <button id="refreshMissing" class="px-3 py-2 text-sm rounded-lg bg-slate-900 text-white hover:bg-slate-800">Refresh</button>
        </div>
      </div>

      <div id="missingGrid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-5"></div>
    </section>

    <!-- REPORT MISSING TO POLICE -->
    <section id="tab-report" class="tab hidden">
      <h2 class="text-2xl font-semibold mb-4">Report Missing to Police</h2>
      <p class="text-slate-600 mb-6">Fill in the details. The report will be forwarded to the nearest police station and a case ID will be generated.</p>

      <form id="reportForm" class="bg-white rounded-2xl shadow p-6 grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Person details -->
        <div class="md:col-span-2">
          <h3 class="font-semibold text-lg mb-2">Person Details</h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium mb-1">Full Name</label>
              <input name="full_name" required class="w-full border rounded-lg px-3 py-2" />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Nickname</label>
              <input name="nickname" class="w-full border rounded-lg px-3 py-2" />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Hometown</label>
              <input name="hometown" class="w-full border rounded-lg px-3 py-2" />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Age</label>
              <input name="age" type="number" min="0" class="w-full border rounded-lg px-3 py-2" />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Weight (kg)</label>
              <input name="weight_kg" type="number" min="0" step="0.1" class="w-full border rounded-lg px-3 py-2" />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Hair Color</label>
              <input name="hair_color" class="w-full border rounded-lg px-3 py-2" />
            </div>
            <div class="sm:col-span-2">
              <label class="block text-sm font-medium mb-1">Photo URL</label>
              <input name="photo_url" placeholder="https://…" class="w-full border rounded-lg px-3 py-2" />
            </div>
          </div>
        </div>

        <!-- Last seen -->
        <div class="md:col-span-2">
          <h3 class="font-semibold text-lg mb-2">Last Seen</h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium mb-1">Time & Date</label>
              <input name="last_seen_time" type="datetime-local" class="w-full border rounded-lg px-3 py-2" />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Location</label>
              <input name="last_seen_location" class="w-full border rounded-lg px-3 py-2" />
            </div>
          </div>
        </div>

        <!-- Description -->
        <div class="md:col-span-2">
          <label class="block text-sm font-medium mb-1">Description (height, blood group, clothing, marks, etc.)</label>
          <textarea name="description" rows="5" class="w-full border rounded-lg px-3 py-2" placeholder="Add height, blood group, clothing, birthmarks/scars, medical attention if needed, etc."></textarea>
        </div>

        <!-- Reporter -->
        <div class="md:col-span-2">
          <h3 class="font-semibold text-lg mb-2">Reporter Contact</h3>
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
            <div>
              <label class="block text-sm font-medium mb-1">Your Name</label>
              <input name="reporter_name" required class="w-full border rounded-lg px-3 py-2" />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Phone</label>
              <input name="reporter_phone" required class="w-full border rounded-lg px-3 py-2" />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Email</label>
              <input name="reporter_email" type="email" class="w-full border rounded-lg px-3 py-2" />
            </div>
          </div>
        </div>

        <div class="md:col-span-2 flex items-center justify-between">
          <div class="text-xs text-slate-500">By submitting, you consent to share these details with law enforcement.</div>
          <button class="px-4 py-2 rounded-lg bg-emerald-600 text-white hover:bg-emerald-700">Submit Report</button>
        </div>
      </form>

      <div id="reportSuccess" class="hidden mt-4 p-4 rounded-xl bg-emerald-50 border border-emerald-200 text-emerald-800">✅ Report submitted successfully. Case ID: <span class="font-mono" id="caseId"></span></div>
    </section>
  </main>

  <!-- Details Modal -->
  <div id="detailsModal" class="hidden fixed inset-0 z-40">
    <div class="absolute inset-0 bg-black/40 backdrop"></div>
    <div class="relative z-10 max-w-2xl mx-auto mt-16 bg-white rounded-2xl shadow-xl overflow-hidden">
      <div class="flex items-center justify-between border-b px-5 py-3">
        <h3 id="modalTitle" class="text-lg font-semibold">Details</h3>
        <button id="closeModal" class="p-2 hover:bg-slate-100 rounded-lg" aria-label="Close"><i data-lucide="x"></i></button>
      </div>
      <div id="modalBody" class="p-5"></div>
    </div>
  </div>

  <script>
    // --- Mock data (replace with API calls) ----------------------------------
    const wantedData = [
      {id:1, name:"Rahim Uddin", photo_url:"https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?q=80&w=600&auto=format&fit=crop", crimes:["Robbery","Extortion"], last_seen_location:"Mirpur, Dhaka", last_seen_time:"2025-09-25T18:30:00", reward:50000, note:"Considered dangerous."},
      {id:2, name:"Tariq Hasan", photo_url:"https://images.unsplash.com/photo-1542202229-7d93c33f5d07?q=80&w=600&auto=format&fit=crop", crimes:["Fraud"], last_seen_location:"Agrabad, Chattogram", last_seen_time:"2025-09-20T14:10:00", reward:20000, note:"Drives a black sedan."},
      {id:3, name:"Unknown Alias 'Blue'", photo_url:"https://images.unsplash.com/photo-1488426862026-3ee34a7d66df?q=80&w=600&auto=format&fit=crop", crimes:["Burglary"], last_seen_location:"Uttara, Dhaka", last_seen_time:"2025-09-28T05:45:00", reward:0, note:"Seen near construction sites."}
    ];

    const missingData = [
      {id:11, name:"Shahin Alam", nickname:"Shuvo", photo_url:"https://images.unsplash.com/photo-1500648767791-00dcc994a43e?q=80&w=600&auto=format&fit=crop", hometown:"Gazipur", age:16, weight_kg:52, hair_color:"Black", last_seen_time:"2025-09-30T19:00:00", last_seen_location:"Jatrabari, Dhaka", description:"Wearing blue t-shirt, white sneakers.", still_with_finder:false},
      {id:12, name:"Nusrat Jahan", nickname:"Nusa", photo_url:"https://images.unsplash.com/photo-1524504388940-b1c1722653e1?q=80&w=600&auto=format&fit=crop", hometown:"Narayanganj", age:8, weight_kg:24, hair_color:"Brown", last_seen_time:"2025-09-29T17:30:00", last_seen_location:"Motijheel, Dhaka", description:"Pink frock, cartoon backpack.", still_with_finder:true}
    ];

    // --- Utilities -----------------------------------------------------------
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
    const $  = (sel, root=document) => root.querySelector(sel);
    const fmt = (dt) => dt ? new Date(dt).toLocaleString() : "";

    // --- Tabs ---------------------------------------------------------------
    function setActiveTab(id){
      $$(".tab").forEach(s=>s.classList.add("hidden"));
      $("#tab-"+id).classList.remove("hidden");
      $$(".tab-btn").forEach(b=>b.classList.toggle("bg-slate-900", b.dataset.tab===id));
      $$(".tab-btn").forEach(b=>b.classList.toggle("text-white", b.dataset.tab===id));
    }
    $$(".tab-btn").forEach(btn=>btn.addEventListener("click",()=>{ setActiveTab(btn.dataset.tab) }));
    $("#tabSelect").addEventListener("change", e=> setActiveTab(e.target.value));
    setActiveTab("wanted");

    // --- Render Wanted ------------------------------------------------------
    function renderWanted(list){
      const grid = $("#wantedGrid");
      grid.innerHTML = "";
      list.forEach(item=>{
        const card = document.createElement("div");
        card.className = "card-hover bg-white rounded-2xl shadow overflow-hidden";
        card.innerHTML = `
          <div class="flip">
            <div class="flip-inner">
              <div class="flip-face p-0">
                <img src="${item.photo_url}" alt="${item.name}" class="w-full h-44 object-cover"/>
                <div class="p-4">
                  <div class="flex items-center justify-between mb-1">
                    <h3 class="font-semibold">${item.name}</h3>
                    <span class="text-xs px-2 py-1 rounded-full bg-red-50 text-red-700 border border-red-200">Wanted</span>
                  </div>
                  <p class="text-sm text-slate-600">Last seen: ${item.last_seen_location} · ${fmt(item.last_seen_time)}</p>
                  <div class="flex gap-2 mt-3">
                    <button class="show-details px-3 py-2 rounded-lg bg-slate-900 text-white text-sm">Show details</button>
                    <button class="flip-btn px-3 py-2 rounded-lg border text-sm">Flip</button>
                  </div>
                </div>
              </div>
              <div class="flip-face flip-back p-4 absolute inset-0 bg-white">
                <h4 class="font-semibold mb-2">Crimes</h4>
                <ul class="list-disc list-inside text-sm text-slate-700">${item.crimes.map(c=>`<li>${c}</li>`).join("")}</ul>
                <p class="mt-3 text-sm text-slate-600">Reward: <span class="font-medium">৳${item.reward.toLocaleString()}</span></p>
                <div class="mt-4 flex gap-2">
                  <button class="show-details px-3 py-2 rounded-lg bg-slate-900 text-white text-sm">Show details</button>
                  <button class="flip-btn px-3 py-2 rounded-lg border text-sm">Flip back</button>
                </div>
              </div>
            </div>
          </div>`;
        // event wiring
        card.querySelectorAll('.show-details').forEach(btn=>btn.addEventListener('click',()=>openWantedModal(item)));
        card.querySelectorAll('.flip-btn').forEach(btn=>btn.addEventListener('click',()=>{
          card.querySelector('.flip').classList.toggle('flipped');
        }));
        grid.appendChild(card);
      });
    }

    function openWantedModal(item){
      $("#modalTitle").textContent = item.name + " – Details";
      $("#modalBody").innerHTML = `
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
          <img src="${item.photo_url}" class="sm:col-span-1 w-full h-40 object-cover rounded-xl"/>
          <div class="sm:col-span-2 text-sm">
            <p><span class="font-medium">Crimes:</span> ${item.crimes.join(', ')}</p>
            <p><span class="font-medium">Last seen:</span> ${item.last_seen_location} at ${fmt(item.last_seen_time)}</p>
            <p><span class="font-medium">Reward:</span> ৳${item.reward.toLocaleString()}</p>
            <p class="mt-2 text-slate-600">${item.note||''}</p>
          </div>
        </div>`;
      toggleModal(true);
    }

    // --- Render Missing -----------------------------------------------------
    function renderMissing(list){
      const grid = $("#missingGrid");
      grid.innerHTML = "";
      list.forEach(item=>{
        const card = document.createElement('div');
        card.className = "card-hover bg-white rounded-2xl shadow overflow-hidden";
        card.innerHTML = `
          <img src="${item.photo_url}" alt="${item.name}" class="w-full h-44 object-cover"/>
          <div class="p-4">
            <div class="flex items-center justify-between mb-1">
              <h3 class="font-semibold">${item.name} <span class="text-slate-400 font-normal">(${item.nickname||'—'})</span></h3>
              <span class="text-xs px-2 py-1 rounded-full ${item.still_with_finder?'bg-emerald-50 text-emerald-700 border border-emerald-200':'bg-amber-50 text-amber-700 border border-amber-200'}">${item.still_with_finder? 'With finder' : 'Unknown'}</span>
            </div>
            <p class="text-sm text-slate-600">Hometown: ${item.hometown||'—'}</p>
            <p class="text-sm text-slate-600">Last seen: ${item.last_seen_location} · ${fmt(item.last_seen_time)}</p>
            <div class="mt-3 flex items-center justify-between">
              <button class="details-missing px-3 py-2 rounded-lg bg-slate-900 text-white text-sm">Show details</button>
              <label class="flex items-center gap-2 text-sm">
                <input type="checkbox" ${item.still_with_finder? 'checked':''} class="still-with-finder"> Still with finder?
              </label>
            </div>
          </div>`;
        card.querySelector('.details-missing').addEventListener('click',()=>openMissingModal(item));
        card.querySelector('.still-with-finder').addEventListener('change', (e)=>{
          item.still_with_finder = e.target.checked;
          renderMissing(missingData.filter(filterMissing)); // refresh tags
          // TODO: PATCH /api/missing/:id {still_with_finder}
        });
        grid.appendChild(card);
      });
    }

    function openMissingModal(item){
      $("#modalTitle").textContent = item.name + " – Details";
      $("#modalBody").innerHTML = `
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
          <img src="${item.photo_url}" class="sm:col-span-1 w-full h-40 object-cover rounded-xl"/>
          <div class="sm:col-span-2 text-sm space-y-1">
            <p><span class="font-medium">Nickname:</span> ${item.nickname||'—'}</p>
            <p><span class="font-medium">Age:</span> ${item.age||'—'} | <span class="font-medium">Weight:</span> ${item.weight_kg||'—'} kg | <span class="font-medium">Hair:</span> ${item.hair_color||'—'}</p>
            <p><span class="font-medium">Hometown:</span> ${item.hometown||'—'}</p>
            <p><span class="font-medium">Last seen:</span> ${item.last_seen_location} at ${fmt(item.last_seen_time)}</p>
            <p class="mt-2 text-slate-600">${item.description||''}</p>
            <div class="mt-3 flex items-center gap-2">
              <input id="modalChk" type="checkbox" ${item.still_with_finder? 'checked':''}>
              <label for="modalChk" class="text-sm">Still with finder?</label>
            </div>
          </div>
        </div>`;
      // Sync back when toggled in modal
      setTimeout(()=>{
        const chk = $("#modalChk"); if(chk){ chk.addEventListener('change', (e)=>{
          item.still_with_finder = e.target.checked; renderMissing(missingData.filter(filterMissing));
          // TODO: PATCH /api/missing/:id {still_with_finder}
        })}
      },0);
      toggleModal(true);
    }

    // --- Modal controls -----------------------------------------------------
    function toggleModal(show){
      const m = $("#detailsModal");
      if(show){ m.classList.remove('hidden'); } else { m.classList.add('hidden'); }
      lucide.createIcons();
    }
    $("#closeModal").addEventListener('click', ()=>toggleModal(false));
    $("#detailsModal").addEventListener('click', (e)=>{ if(e.target.id==='detailsModal') toggleModal(false) });

    // --- Searching & refresh ------------------------------------------------
    function filterWanted(item){
      const q = $("#searchWanted").value.trim().toLowerCase();
      if(!q) return true;
      return item.name.toLowerCase().includes(q) || item.last_seen_location.toLowerCase().includes(q) || item.crimes.join(' ').toLowerCase().includes(q);
    }
    function filterMissing(item){
      const q = $("#searchMissing").value.trim().toLowerCase();
      if(!q) return true;
      return item.name.toLowerCase().includes(q) || (item.hometown||'').toLowerCase().includes(q) || (item.nickname||'').toLowerCase().includes(q);
    }

    $("#searchWanted").addEventListener('input', ()=>renderWanted(wantedData.filter(filterWanted)));
    $("#searchMissing").addEventListener('input', ()=>renderMissing(missingData.filter(filterMissing)));
    $("#refreshWanted").addEventListener('click', ()=>{
      // TODO: fetch('/api/wanted').then(r=>r.json()).then(data=>{ wantedData = data; renderWanted(data) })
      renderWanted(wantedData.filter(filterWanted));
    });
    $("#refreshMissing").addEventListener('click', ()=>{
      // TODO: fetch('/api/missing').then(r=>r.json()).then(data=>{ missingData = data; renderMissing(data) })
      renderMissing(missingData.filter(filterMissing));
    });

    // --- Report form submit -------------------------------------------------
    $("#reportForm").addEventListener('submit', async (e)=>{
      e.preventDefault();
      const fd = new FormData(e.target);
      const payload = Object.fromEntries(fd.entries());
      // TODO: await fetch('/api/reports/missing', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
      const generatedId = 'MS-' + Math.floor(100000 + Math.random()*900000);
      $("#caseId").textContent = generatedId;
      $("#reportSuccess").classList.remove('hidden');
      e.target.reset();
      window.scrollTo({top:0, behavior:'smooth'});
    });

    // --- First render -------------------------------------------------------
    renderWanted(wantedData);
    renderMissing(missingData);
    lucide.createIcons();
  </script>

  <!--
  ========================= BACKEND BLUEPRINT (MySQL) =========================

  -- WANTED CRIMINALS
  CREATE TABLE wanted_criminals (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(120) NOT NULL,
    photo_url VARCHAR(500),
    last_seen_location VARCHAR(200),
    last_seen_time DATETIME,
    reward_bdt INT DEFAULT 0,
    note TEXT,
    status ENUM('wanted','caught','inactive') DEFAULT 'wanted'
  );

  CREATE TABLE criminal_offenses (
    id INT AUTO_INCREMENT PRIMARY KEY,
    criminal_id INT NOT NULL,
    offense VARCHAR(200) NOT NULL,
    FOREIGN KEY (criminal_id) REFERENCES wanted_criminals(id) ON DELETE CASCADE
  );

  -- MISSING PERSONS
  CREATE TABLE missing_persons (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(120) NOT NULL,
    nickname VARCHAR(120),
    hometown VARCHAR(120),
    age INT,
    weight_kg DECIMAL(5,2),
    hair_color VARCHAR(60),
    photo_url VARCHAR(500),
    last_seen_location VARCHAR(200),
    last_seen_time DATETIME,
    description TEXT,
    still_with_finder TINYINT(1) DEFAULT 0,
    status ENUM('open','found','closed') DEFAULT 'open'
  );

  -- REPORTS TO POLICE (MISSING)
  CREATE TABLE missing_reports (
    id INT AUTO_INCREMENT PRIMARY KEY,
    person_name VARCHAR(120) NOT NULL,
    nickname VARCHAR(120),
    hometown VARCHAR(120),
    age INT,
    weight_kg DECIMAL(5,2),
    hair_color VARCHAR(60),
    photo_url VARCHAR(500),
    last_seen_location VARCHAR(200),
    last_seen_time DATETIME,
    description TEXT,
    reporter_name VARCHAR(120) NOT NULL,
    reporter_phone VARCHAR(40) NOT NULL,
    reporter_email VARCHAR(120),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
  );

  -- Minimal REST endpoints (Node/Express, Flask, or PHP)
  GET    /api/wanted                 -> list wanted criminals (JOIN offenses)
  GET    /api/wanted/:id            -> single criminal + offenses
  GET    /api/missing               -> list missing persons
  PATCH  /api/missing/:id           -> update still_with_finder
  POST   /api/reports/missing       -> submit a missing report

  Example raw SQL (PHP/MySQLi or Node mysql2):
  SELECT w.*, GROUP_CONCAT(o.offense SEPARATOR ',') AS offenses
  FROM wanted_criminals w LEFT JOIN criminal_offenses o ON o.criminal_id=w.id
  GROUP BY w.id;

  UPDATE missing_persons SET still_with_finder=? WHERE id=?;

  INSERT INTO missing_reports (...columns...) VALUES (...values...);
  ==========================================================================
  -->
</body>
</html>
